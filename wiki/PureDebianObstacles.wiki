#Засада с ядром

= Почему получилось только наполовину? =

== Поддержка APM82181 в ядре ===

Если сравнить ванильное ядро 2.6.22-11 с тем 2.6.32-11, что предлагает WD по GPL, то видно, что была проведена немалая работа по допиливанию поддежки SoC'а. На MBL можно [http://qfairy2.blogspot.ru/2013/04/running-on-kernel-390-rc8.html запустить] хоть kernel 3.9.0, но DMA, аппаратный криптодвижок и ряд других функций задействованы не будут. Получится некий сферический Linux, который по производительности будет явно проигрывать заводскому варианту. А втаскивать перечисленные плюшки на актуальное ядро я в одиночку не готов.

== Отсутствие accept4() в GPL ядре ==

В отличие от заводского Debian Lenny (5), Debian Squeeze (6) Wheezy (7) [http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=648325 используют] udev, полагающийся на "новый" syscall accept4(), который отсутствует в 2.6.22-11. Этот syscall появится для powerpc в ядре куда позже. Без него, повторюсь, новый udev будет неработоспособен, и, следственно, популяция устройств в /dev тоже будет поломанной. Можно установить в Debian старый udev и [http://mybookworld.wikidot.com/mybook-live выполнить] `aptitude hold udev` для того, чтобы менеджер пакетов оставил его в покое, но, к сожалению, на udev "завязано" слишком много других пакетов. Выходов несколько:

  * или портировать полноценную поддержку SoC'а на 2.6.22-35,
  * или бэкпортировать в заводское ядро accept4(), как это [http://wl500g.googlecode.com/svn-history/r3779/trunk/kernel-2.6/167-accept4.patch сделали] энтузиасты, 
  * или [https://github.com/gentoo/eudev/issues/7#issuecomment-10502344 патчить] новый udev для того, чтобы была работоспособна Debian Wheezy (правда позже может найтись ещё софт, завязанный на accep4()), например, glibc,
  * или отказаться от нового Debian'а в пользу другого дистрибутива, который accept4() не использует.